<div class="top-container">
  <%# // Welcome message %>
  <div class="welcome-info">
    <h3>Hello <%= current_user.first_name %> ‚ò∫ </h3>
    <h4>You have <%= pluralize @items.count, 'saved bookmark' %> ‚úåÔ∏è üõí</h4>
  </div>
</div>

<div class="mid-container">
  <%# // search form starts here %>
  <div class="search-bar">
    <%= form_tag items_path, method: :get do %>
      <div class="search-form-control form-group">
        <%= text_field_tag :query,
          params[:query],
          class: "form-control",
          placeholder: "Search ..."
        %>
        <button name="button" type="submit" class="btn btn-ghost-search">
        <%# <%= submit_tag "Go!", class: "btn btn-primary btn-sm" %>
          <i class="fas fa-search"></i>
        </button>
      </div>
    <% end %>
  </div>
  <div class="create-sort">
    <%# // Create button %>
    <div class="item-create">
      <%= link_to 'add an item', new_item_path, class: 'btn btn-ghost-item' %>
    </div>

    <%# // sort form starts here %>
    <div class="sort-form-ghost">
      <%= form_tag items_path, method: :get do  %>
        <div class="search-form-control form-group">
          <%= select_tag(:sort, options_for_select([["Alphabetical", :name],["Highest Price", :price],["Oldest",:created_at]], params[:sort]), {prompt: "Sort By", onchange: "this.form.submit()"})%>
        <%# <%= submit_tag "Sort", class: "btn btn-primary"%>
            </div>
        <% end %>
  </div>
</div>
</div>

<div class="content-container">
  <%# // sidebar %>
  <div class="sidebar">
    <%= link_to "All", items_path, class: "btn btn-category #{"active" unless params[:filter]}" %>
    <a class="btn btn-category">Purchased</a>
    <% @categories.each do |category| %>
      <%= link_to category, items_path(sort: params[:sort], query: params[:query], filter: category), class: "btn btn-category #{"active" if params[:filter] == category }" %>
    <% end %>
  </div>

  <%# // The Cards are coded below %>
  <div class="item-cards">
    <%# <div class="item-card"> %>
      <% @items.each do |item| %>
      <%# // Main body of the cards starts here; only showing the first image %>
      <div class="item-card">
        <img src=<%= item.image_url.first %> class="card-img-top" width = "50px" height = "230px">

        <div class="card-body">
          <h5 class="card-title"><%= item.name %></h5>
          <p class="card-text">Price: <%= "#{item.currency}#{'%.2f' % (item.price.to_f/100).to_s}" %> <s> <%= (item.original_price.to_i)>0 ? "#{item.currency}#{item.original_price.to_f/100}" : ""%></s> </p>
          <p class="category-description"> Category: <%= item.category.name %></p>
        </div>

        <div class="card-footer">
          <%# // Footer with all the buttons starts here %>
          <%# // This is the Delete button %>
          <%= link_to "Delete", item_path(item), method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-outline-danger btn-sm"%>
          <%# // This is the More button %>
          <button type="button" class="btn btn-dark btn-sm" data-toggle="modal" data-target="#<%= dom_id(item) %>">
            More Info</button>
            <%# // This is the code for the More button popup window %>
            <div class="modal fade" id="<%= dom_id(item) %>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><%= item.name %></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div class="item-details">
                      <%# // Caroussel for the popup "more info window %>
                      <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                          <div class="carousel-item active">
                            <img class="d-block w-30" src=<%= item.image_url[0] %> alt="First slide">
                          </div>
                          <div class="carousel-item">
                            <img class="d-block w-30" src=<%= item.image_url[1] %> alt="Second slide">
                          </div>
                          <div class="carousel-item">
                            <img class="d-block w-30" src=<%= item.image_url[2] %> alt="Third slide">
                          </div>
                        </div>
                        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                          <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                          <span class="carousel-control-next-icon" aria-hidden="true"></span>
                          <span class="sr-only">Next</span>
                        </a>
                      </div>
                      <%# // end of code for caroussel %>
                      <h4><%= item.description %><h4>
                      <h4><%= item.price %><h4>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <a class="btn btn-info" href="<%= item.item_url %>">Go website</a>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
          <%# // This is the Change Button %>
          <%= link_to 'Change category', edit_item_path(item), class: "btn btn-dark btn-sm" %>
          <%# // The Buy button starts here %>
          <button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#exampleModal2">
            Buy</button>
            <div class="modal fade" id="exampleModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel2">Purchase Confirmation</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    ** Thank you for your purchase ** <p></p><p>
                    Your item is on it's way.</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Got it!</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
